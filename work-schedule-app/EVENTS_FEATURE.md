# 🎉 Евенти Функционалност - Документация

## Преглед

Добавена е нова функционалност за **събития (Events)**, която позволява на служителите да:
- ✅ Създават нови събития с име и дата
- ✅ Гласуват за събития с 3 опции: **Да**, **Не**, **Обмислям**
- ✅ Виждат статистика на гласовете в реално време
- ✅ Изтриват събития
- ✅ Виждат предстоящи събития на Dashboard-а

---

## 🚀 Настройка

### Стъпка 1: Изпълни SQL скрипта

1. Отвори [Supabase Dashboard](https://supabase.com/dashboard)
2. Отиди на **SQL Editor**
3. Копирай кода от файла **`SUPABASE_EVENTS_SETUP.sql`**
4. Изпълни го (Run/F5)

Това ще създаде:
- **`events`** таблица - за съхранение на събития
- **`votes`** таблица - за съхранение на гласове
- **RLS политики** - за сигурност
- **Индекси** - за бързина
- **View** - за лесна статистика

### Стъпка 2: Стартирай приложението

```bash
npm run dev
```

### Стъпка 3: Тествай!

1. Влез в системата (избери потребител)
2. Отиди на **Events** в sidebar
3. Създай ново събитие
4. Гласувай!

---

## 📱 Функции

### 1. Създаване на Събитие

- Натисни бутона **"Добави събитие"**
- Попълни:
  - **Име на събитието** (напр. "Коледна партита", "Team Building")
  - **Дата на събитието**
- Натисни **"Създай събитие"**

### 2. Гласуване

Всяко събитие има 3 бутона за гласуване:

| Бутон | Значение | Цвят |
|-------|----------|------|
| **✓ Да** | Ще присъствам | Зелен |
| **✗ Не** | Няма да присъствам | Червен |
| **? Обмислям** | Не съм сигурен/а | Жълт |

- Можеш да гласуваш само **веднъж** за събитие
- Можеш да **промениш гласа си** по всяко време
- Твоят глас се **подчертава** с по-ярък цвят

### 3. Статистика

За всяко събитие виждаш:
- 📊 Брой "Да" гласове
- 📊 Брой "Не" гласове
- 📊 Брой "Обмислям" гласове
- 📊 Общо гласове

### 4. Изтриване на Събитие

- Натисни иконата **🗑️** (кошче)
- Потвърди изтриването
- Събитието се архивира (не се изтрива напълно от БД)

### 5. Dashboard Preview

На **Home страницата** виждаш:
- 📅 До 3 предстоящи събития
- 📆 Дата и име на събитието
- 🔗 Клик на събитие те води към Events страницата

---

## 🎨 UI Елементи

### Events Page

```
┌─────────────────────────────────────┐
│  🎉 События     [+ Добави събитие]  │
├─────────────────────────────────────┤
│                                     │
│  ┌─────────────────────────────┐   │
│  │ Team Building 2024      🗑️  │   │
│  │ 📅 15 ноември 2024          │   │
│  │ 👤 Създадено от: София     │   │
│  ├─────────────────────────────┤   │
│  │   ✓ Да    ✗ Не   ? Обмислям│   │
│  │    5        2        3      │   │
│  ├─────────────────────────────┤   │
│  │ [✓ Да] [ ✗ Не] [? Обмислям]│   │
│  └─────────────────────────────┘   │
│                                     │
└─────────────────────────────────────┘
```

### Home Dashboard Card

```
┌───────────────────────┐
│  🎉 Події             │
│  Виж всички →         │
├───────────────────────┤
│  15  Team Building    │
│      ноември          │
├───────────────────────┤
│  20  Коледна партита  │
│      декември         │
└───────────────────────┘
```

---

## 💾 Database Schema

### Таблица: `events`

| Колона | Тип | Описание |
|--------|-----|----------|
| `id` | UUID | Уникален идентификатор |
| `title` | TEXT | Име на събитието |
| `event_date` | DATE | Дата на събитието |
| `created_by` | UUID | ID на създателя (FK към employees) |
| `created_at` | TIMESTAMP | Дата на създаване |
| `is_active` | BOOLEAN | Активно ли е (за soft delete) |

### Таблица: `votes`

| Колона | Тип | Описание |
|--------|-----|----------|
| `id` | UUID | Уникален идентификатор |
| `event_id` | UUID | ID на събитието (FK към events) |
| `employee_id` | UUID | ID на служителя (FK към employees) |
| `vote_type` | TEXT | Тип глас: 'yes', 'no', 'maybe' |
| `created_at` | TIMESTAMP | Дата на създаване |
| `updated_at` | TIMESTAMP | Дата на последна промяна |

**UNIQUE Constraint:** (`event_id`, `employee_id`) - Всеки служител може да гласува само веднъж за събитие

---

## 🔒 Security (RLS)

### Events Policies

✅ **SELECT** - Всички могат да виждат активните събития
```sql
WHERE is_active = true
```

✅ **INSERT** - Всички могат да създават събития
```sql
WITH CHECK (true)
```

✅ **DELETE** - Всички могат да изтриват събития (soft delete)
```sql
USING (true)
```

✅ **UPDATE** - Всички могат да обновяват събития
```sql
USING (true) WITH CHECK (true)
```

### Votes Policies

✅ **SELECT** - Всички могат да виждат гласовете
✅ **INSERT** - Всички могат да гласуват
✅ **UPDATE** - Всеки може да обновява своя глас
✅ **DELETE** - Всеки може да изтрива своя глас

---

## 📊 API Reference

### Зареждане на събития с гласове

```javascript
// Зареждане на всички активни събития
const { data: eventsData } = await supabase
    .from('events')
    .select(`
        *,
        created_by_employee:employees!events_created_by_fkey(name)
    `)
    .eq('is_active', true)
    .order('event_date', { ascending: true });

// Зареждане на гласовете за събитие
const { data: votesData } = await supabase
    .from('votes')
    .select('*, employee:employees(name)')
    .eq('event_id', event.id);
```

### Създаване на събитие

```javascript
const { error } = await supabase
    .from('events')
    .insert([{
        title: 'Team Building 2024',
        event_date: '2024-11-15',
        created_by: user.id
    }]);
```

### Гласуване

```javascript
// Ново гласуване
const { error } = await supabase
    .from('votes')
    .insert([{
        event_id: eventId,
        employee_id: user.id,
        vote_type: 'yes' // or 'no', 'maybe'
    }]);

// Промяна на глас
const { error } = await supabase
    .from('votes')
    .update({ vote_type: 'no' })
    .eq('id', voteId);
```

### Изтриване на събитие (Soft Delete)

```javascript
const { error } = await supabase
    .from('events')
    .update({ is_active: false })
    .eq('id', eventId);
```

---

## 🎯 Use Cases

### Use Case 1: Team Building

```
1. София създава събитие "Team Building 2024" за 15 ноември
2. Всички служители получават достъп до събитието
3. Всеки гласува дали ще присъства
4. София вижда статистиката: 12 Да, 3 Не, 5 Обмислям
5. София планира според резултатите
```

### Use Case 2: Коледна партита

```
1. Борис създава "Коледна партита" за 20 декември
2. Румен гласува "Да"
3. Виктория гласува "Обмислям"
4. След 2 дни Виктория променя гласа си на "Да"
5. Всички виждат актуалната статистика
```

---

## 📁 Файлова структура

### Нови файлове:

```
src/
├── pages/
│   └── Events.jsx              # Events страница с пълна функционалност
│
SUPABASE_EVENTS_SETUP.sql       # SQL за database setup
EVENTS_FEATURE.md               # Тази документация
```

### Модифицирани файлове:

```
src/
├── App.jsx                     # Добавен Events route
├── pages/
│   └── Home.jsx                # Добавен Events container
├── components/
    ├── Sidebar.jsx             # Добавен Events nav item
    └── BottomNav.jsx           # Добавен Events бутон
```

---

## 🐛 Troubleshooting

### Грешка: "relation events does not exist"

**Решение:**
- Изпълни `SUPABASE_EVENTS_SETUP.sql` в Supabase SQL Editor

### Гласуването не работи

**Решение:**
1. Провери дали си логнат (има user в localStorage)
2. Провери конзолата за грешки
3. Провери RLS политиките в Supabase

### Не виждам предстоящи събития на Dashboard

**Решение:**
- Създай събитие с дата в бъдещето (не минало)
- Провери дали `is_active = true`

### Не мога да изтрия събитие

**Решение:**
- Провери дали имаш права (RLS политиките позволяват изтриване)
- Изтриването е "soft delete" - `is_active = false`

---

## ✨ Features Highlights

### Real-time Updates
- ✅ Статистиката се обновява веднага след гласуване
- ✅ Новите събития се показват веднага

### User Experience
- ✅ Интуитивен UI с емоджита и цветове
- ✅ Hover ефекти на бутоните
- ✅ Responsive дизайн
- ✅ Loading states

### Data Integrity
- ✅ Един глас на човек за събитие
- ✅ Възможност за промяна на глас
- ✅ Soft delete на събития
- ✅ Foreign keys за връзки

---

## 🔮 Бъдещи подобрения (Опционално)

- 📧 Email notifications при ново събитие
- 💬 Коментари под събития
- 📸 Снимки от събития
- 🔔 Push notifications
- 📊 Advanced статистика
- 📅 Експорт в календар (iCal)
- 🎨 Customize event colors
- 👥 Event organizers (роли)
- 🔒 Private events

---

## 📞 Поддръжка

Ако имаш въпроси:
1. Провери тази документация
2. Провери `SUPABASE_EVENTS_SETUP.sql` дали е изпълнен
3. Провери конзолата (F12) за грешки
4. Провери Supabase логовете

---

## 🎉 Готово!

Events функционалността е напълно интегрирана и готова за употреба!

**Основни предимства:**
- ✅ Лесно създаване на събития
- ✅ Бързо гласуване
- ✅ Реална статистика
- ✅ Красив UI
- ✅ Сигурна база данни

Enjoy! 🚀

